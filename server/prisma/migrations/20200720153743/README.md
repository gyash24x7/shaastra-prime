# Migration `20200720153743`

This migration has been generated by gyash24x7 at 7/20/2020, 3:37:43 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "ChannelType" AS ENUM ('DIRECT', 'GROUP');

CREATE TABLE "public"."Channel" (
"archived" boolean  NOT NULL DEFAULT false,"createdById" text  NOT NULL ,"createdOn" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"description" text  NOT NULL ,"id" text  NOT NULL ,"name" text  NOT NULL ,"type" "ChannelType" NOT NULL DEFAULT E'GROUP',
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_ChannelMembers" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE UNIQUE INDEX "Channel.name" ON "public"."Channel"("name")

CREATE UNIQUE INDEX "_ChannelMembers_AB_unique" ON "public"."_ChannelMembers"("A","B")

CREATE  INDEX "_ChannelMembers_B_index" ON "public"."_ChannelMembers"("B")

ALTER TABLE "public"."Channel" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ChannelMembers" ADD FOREIGN KEY ("A")REFERENCES "public"."Channel"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ChannelMembers" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200707154944..20200720153743
--- datamodel.dml
+++ datamodel.dml
@@ -2,34 +2,53 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
 model User {
-  id              String   @default(cuid()) @id
+  id              String    @default(cuid()) @id
   name            String
-  email           String   @unique
+  email           String    @unique
   rollNumber      String
   password        String
-  salt            String   @unique
-  role            UserRole @default(COORD)
+  salt            String    @unique
+  role            UserRole  @default(COORD)
   mobile          String
-  upi             String   @default("")
-  about           String   @default("")
-  verified        Boolean  @default(false)
+  upi             String    @default("")
+  about           String    @default("")
+  verified        Boolean   @default(false)
   verificationOTP String
   passwordOTP     String?
   department      String
+  channels        Channel[] @relation("ChannelMembers", references: [id])
+  channelsCreated Channel[] @relation("ChannelCreatedBy")
 }
 enum UserRole {
   COORD
   HEAD
   CORE
   COCAS
 }
+
+model Channel {
+  id          String      @default(cuid()) @id
+  name        String      @unique
+  description String
+  createdOn   DateTime    @default(now())
+  archived    Boolean     @default(false)
+  type        ChannelType @default(GROUP)
+  members     User[]      @relation("ChannelMembers", references: [id])
+  createdBy   User        @relation("ChannelCreatedBy", fields: [createdById], references: [id])
+  createdById String
+}
+
+enum ChannelType {
+  DIRECT
+  GROUP
+}
```


