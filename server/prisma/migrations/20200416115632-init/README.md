# Migration `20200416115632-init`

This migration has been generated by Yash Gupta at 4/16/2020, 11:56:32 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "TaskStatus" AS ENUM ('NOT_ASSIGNED', 'ASSIGNED', 'IN_PROGRESS', 'SUBMITTED', 'COMPLETED');

CREATE TYPE "ReactionType" AS ENUM ('LIKE', 'LOVE', 'HAHA', 'ANGER', 'SAD');

CREATE TYPE "MediaType" AS ENUM ('IMAGE', 'AUDIO', 'VIDEO', 'DOC', 'CODE');

CREATE TYPE "UserRole" AS ENUM ('COORD', 'HEAD', 'CORE', 'COCAS', 'COCAD');

CREATE TABLE "public"."Department" (
    "id" SERIAL,
    "name" text  NOT NULL ,
    "subDepartments" text []  ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."User" (
    "about" text  NOT NULL ,
    "coverPic" text  NOT NULL ,
    "email" text  NOT NULL ,
    "id" SERIAL,
    "mobile" text  NOT NULL ,
    "name" text  NOT NULL ,
    "password" text  NOT NULL ,
    "passwordOTP" text   ,
    "profilePic" text  NOT NULL ,
    "role" "UserRole" NOT NULL DEFAULT 'COORD',
    "rollNumber" text  NOT NULL ,
    "upi" text  NOT NULL ,
    "verificationOTP" text  NOT NULL ,
    "verified" boolean  NOT NULL DEFAULT false,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Channel" (
    "archived" boolean  NOT NULL DEFAULT false,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdById" integer  NOT NULL ,
    "description" text  NOT NULL ,
    "id" SERIAL,
    "name" text  NOT NULL ,
    "taskId" integer   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Message" (
    "channelId" integer  NOT NULL ,
    "content" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdById" integer  NOT NULL ,
    "id" SERIAL,
    "starred" boolean  NOT NULL DEFAULT false,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Media" (
    "channelId" integer   ,
    "id" SERIAL,
    "taskId" integer   ,
    "type" "MediaType" NOT NULL ,
    "uploadedById" integer  NOT NULL ,
    "url" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Reaction" (
    "byId" integer  NOT NULL ,
    "id" SERIAL,
    "messageId" integer  NOT NULL ,
    "type" "ReactionType" NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Task" (
    "brief" text  NOT NULL ,
    "byDeptId" integer  NOT NULL ,
    "channelId" integer  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdById" integer  NOT NULL ,
    "deadline" timestamp(3)  NOT NULL ,
    "details" text  NOT NULL ,
    "forDeptId" integer  NOT NULL ,
    "id" SERIAL,
    "status" "TaskStatus" NOT NULL DEFAULT 'NOT_ASSIGNED',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Update" (
    "byDeptId" integer  NOT NULL ,
    "content" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "departmentId" integer   ,
    "id" SERIAL,
    "postedById" integer  NOT NULL ,
    "subject" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."_DepartmentMembers" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

CREATE TABLE "public"."_ChannelMembers" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

CREATE TABLE "public"."_TasksForUser" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "User.rollNumber" ON "public"."User"("rollNumber")

CREATE UNIQUE INDEX "Task_channelId" ON "public"."Task"("channelId")

CREATE UNIQUE INDEX "_DepartmentMembers_AB_unique" ON "public"."_DepartmentMembers"("A","B")

CREATE  INDEX "_DepartmentMembers_B_index" ON "public"."_DepartmentMembers"("B")

CREATE UNIQUE INDEX "_ChannelMembers_AB_unique" ON "public"."_ChannelMembers"("A","B")

CREATE  INDEX "_ChannelMembers_B_index" ON "public"."_ChannelMembers"("B")

CREATE UNIQUE INDEX "_TasksForUser_AB_unique" ON "public"."_TasksForUser"("A","B")

CREATE  INDEX "_TasksForUser_B_index" ON "public"."_TasksForUser"("B")

ALTER TABLE "public"."Channel" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Message" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Message" ADD FOREIGN KEY ("channelId")REFERENCES "public"."Channel"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Media" ADD FOREIGN KEY ("uploadedById")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Media" ADD FOREIGN KEY ("taskId")REFERENCES "public"."Task"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Media" ADD FOREIGN KEY ("channelId")REFERENCES "public"."Channel"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Reaction" ADD FOREIGN KEY ("byId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Reaction" ADD FOREIGN KEY ("messageId")REFERENCES "public"."Message"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Task" ADD FOREIGN KEY ("byDeptId")REFERENCES "public"."Department"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Task" ADD FOREIGN KEY ("forDeptId")REFERENCES "public"."Department"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Task" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Task" ADD FOREIGN KEY ("channelId")REFERENCES "public"."Channel"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Update" ADD FOREIGN KEY ("byDeptId")REFERENCES "public"."Department"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Update" ADD FOREIGN KEY ("postedById")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Update" ADD FOREIGN KEY ("departmentId")REFERENCES "public"."Department"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."_DepartmentMembers" ADD FOREIGN KEY ("A")REFERENCES "public"."Department"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_DepartmentMembers" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ChannelMembers" ADD FOREIGN KEY ("A")REFERENCES "public"."Channel"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ChannelMembers" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_TasksForUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Task"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_TasksForUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200416115632-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,152 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Department {
+  id             Int      @default(autoincrement()) @id
+  name           String
+  subDepartments String[]
+  members        User[]   @relation("DepartmentMembers", references: [id])
+  tasksAssigned  Task[]   @relation("TasksForDept")
+  tasksCreated   Task[]   @relation("TasksByDept")
+  updates        Update[] @relation("DeptUpdates")
+}
+
+model User {
+  id              Int          @default(autoincrement()) @id
+  name            String
+  email           String       @unique
+  password        String
+  rollNumber      String       @unique
+  profilePic      String
+  coverPic        String
+  mobile          String
+  upi             String
+  about           String
+  role            UserRole     @default(COORD)
+  verified        Boolean      @default(false)
+  verificationOTP String
+  passwordOTP     String?
+  departments     Department[] @relation("DepartmentMembers", references: [id])
+  channels        Channel[]    @relation("ChannelMembers", references: [id])
+  channelsCreated Channel[]    @relation("ChannelsByUser")
+  messages        Message[]    @relation("MessagesByUser")
+  media           Media[]      @relation("MediaByUser")
+  tasksCreated    Task[]       @relation("TasksByUser")
+  tasksAssigned   Task[]       @relation("TasksForUser", references: [id])
+}
+
+model Channel {
+  id          Int       @default(autoincrement()) @id
+  name        String
+  description String
+  createdAt   DateTime  @default(now())
+  archived    Boolean   @default(false)
+  messages    Message[] @relation("ChannelMessages")
+  createdBy   User      @relation("ChannelsByUser", fields: [createdById], references: [id])
+  members     User[]    @relation("ChannelMembers", references: [id])
+  media       Media[]   @relation("ChannelMedia")
+  task        Task?     @relation("ChannelTask")
+  createdById Int
+  taskId      Int?
+}
+
+model Message {
+  id          Int        @default(autoincrement()) @id
+  content     String
+  createdAt   DateTime   @default(now())
+  createdBy   User       @relation("MessagesByUser", fields: [createdById], references: [id])
+  channel     Channel    @relation("ChannelMessages", fields: [channelId], references: [id])
+  starred     Boolean    @default(false)
+  reactions   Reaction[] @relation("MessageReactions")
+  createdById Int
+  channelId   Int
+}
+
+model Media {
+  id           Int       @default(autoincrement()) @id
+  url          String
+  type         MediaType
+  uploadedBy   User      @relation("MediaByUser", fields: [uploadedById], references: [id])
+  task         Task?     @relation("TaskMedia", fields: [taskId], references: [id])
+  taskId       Int?
+  channel      Channel?  @relation("ChannelMedia", fields: [channelId], references: [id])
+  uploadedById Int
+  channelId    Int?
+}
+
+model Reaction {
+  id        Int          @default(autoincrement()) @id
+  type      ReactionType
+  by        User         @relation("UserReactions", fields: [byId], references: [id])
+  message   Message      @relation("MessageReactions", fields: [messageId], references: [id])
+  byId      Int
+  messageId Int
+}
+
+model Task {
+  id          Int        @default(autoincrement()) @id
+  brief       String
+  details     String
+  byDept      Department @relation("TasksByDept", fields: [byDeptId], references: [id])
+  forDept     Department @relation("TasksForDept", fields: [forDeptId], references: [id])
+  createdBy   User       @relation("TasksByUser", fields: [createdById], references: [id])
+  assignedTo  User[]     @relation("TasksForUser", references: [id])
+  status      TaskStatus @default(NOT_ASSIGNED)
+  createdAt   DateTime   @default(now())
+  deadline    DateTime
+  channel     Channel    @relation("ChannelTask", fields: [channelId], references: [id])
+  media       Media[]    @relation("TaskMedia")
+  byDeptId    Int
+  forDeptId   Int
+  createdById Int
+  channelId   Int
+}
+
+model Update {
+  id           Int        @default(autoincrement()) @id
+  subject      String
+  content      String
+  byDept       Department @relation("DepartmentUpdates", fields: [byDeptId], references: [id])
+  postedBy     User       @relation("UserUpdate", fields: [postedById], references: [id])
+  createdAt    DateTime   @default(now())
+  postedById   Int
+  byDeptId     Int
+}
+
+enum TaskStatus {
+  NOT_ASSIGNED
+  ASSIGNED
+  IN_PROGRESS
+  SUBMITTED
+  COMPLETED
+}
+
+enum ReactionType {
+  LIKE
+  LOVE
+  HAHA
+  ANGER
+  SAD
+}
+
+enum MediaType {
+  IMAGE
+  AUDIO
+  VIDEO
+  DOC
+  CODE
+}
+
+enum UserRole {
+  COORD
+  HEAD
+  CORE
+  COCAS
+  COCAD
+}
```


